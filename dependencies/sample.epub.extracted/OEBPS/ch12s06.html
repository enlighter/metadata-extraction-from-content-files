<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Revisiting attribute manipulation</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Revisiting attribute manipulation"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec97"/>Revisiting attribute manipulation</h1></div></div></div><p>By now, we are very used to getting and setting values that are associated with DOM elements. We have done this with simple methods like <code class="literal">.attr()</code>, <code class="literal">.prop()</code>, and <code class="literal">.css()</code>, convenient shorthands such as <code class="literal">.addClass()</code>, <code class="literal">.css()</code>, and <code class="literal">.val()</code>, and complex bundles of behavior such as <code class="literal">.animate()</code>. Even the simple methods, though, do quite a bit of work for us behind the scenes. We can get yet more utility out of them if we better understand what they do.</p><div class="section" title="Using shorthand element-creation syntax"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec142"/>Using shorthand element-creation syntax</h2></div></div></div><p>We often create <a id="id1007" class="indexterm"/>new elements in our jQuery code by providing an <a id="id1008" class="indexterm"/>HTML string to the <code class="literal">$()</code> function or to DOM insertion functions. For example, we create a quite large HTML fragment in <span class="emphasis"><em>Listing 12.9</em></span>
<span class="strong"><strong> </strong></span>in order to produce many DOM elements. This technique is fast and concise. There are circumstances when it is not ideal, however; we might, for instance, want to escape special characters from text before it is used, or apply style rules that are browser-dependent. In these cases, we can create the element and then chain on additional jQuery methods to alter it, as we have done many times in the past. In addition to this standard technique, the <code class="literal">$()</code> function itself provides an alternative syntax to achieve the same result.</p><p>Suppose we want to introduce <a id="id1009" class="indexterm"/>headings prior to each of the tables in our document. We can use an <code class="literal">.each()</code> loop to iterate over the tables and create an appropriately-named heading prior to each one:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('table').each(function(index) {
    var $table = $(this);
    $('&lt;h3&gt;&lt;/h3&gt;', {
      id: 'table-title-' + index,
      'class': 'table-title',
      text: 'Table ' + (index + 1),
      data: {'index': index},
      click: function(event) {
        event.preventDefault();
        $table.fadeToggle();
      },
      css: {glowColor: '#00ff00'}
    }).insertBefore($table);
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 12.14</em></span>
</p><p>Providing an options object as the second argument to the <code class="literal">$()</code> function has the same effect as first creating the element then passing that object to the <code class="literal">.attr()</code> method. As we know, this method lets us set DOM attributes such as the <code class="literal">id</code> value of the element and its <code class="literal">class</code>.</p><p>The rest of the options <a id="id1010" class="indexterm"/>in our example, however, might be a little confusing at first. We are specifying:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The text inside the element</li><li class="listitem" style="list-style-type: disc">Custom additional data</li><li class="listitem" style="list-style-type: disc">A click handler</li><li class="listitem" style="list-style-type: disc">An object containing CSS properties</li></ul></div><p>These are not DOM attributes, yet they get set all the same. The shorthand <code class="literal">$()</code> syntax is able to handle these because it first checks to see if a jQuery method exists with the given name, and if so, it calls it instead of setting the attribute of that name.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note23"/>Note</h3><p>Because jQuery gives methods precedence over attribute names, we must take care in cases where meaning might be ambiguous; for example, the <code class="literal">size</code> attribute of <code class="literal">&lt;input&gt;</code> elements, which cannot be set this way because a <code class="literal">.size()</code> method also exists.</p></div></div><p>This shorthand <code class="literal">$()</code> syntax, along <a id="id1011" class="indexterm"/>with the <code class="literal">.attr()</code> function, <a id="id1012" class="indexterm"/>can handle even more features through the use of <span class="strong"><strong>hooks</strong></span>.</p></div><div class="section" title="DOM manipulation hooks"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec143"/>DOM manipulation hooks</h2></div></div></div><p>Many jQuery methods that <a id="id1013" class="indexterm"/>get and set properties can be extended for special cases by <a id="id1014" class="indexterm"/>defining the appropriate hooks. These hooks are arrays in the jQuery namespace with names such as <code class="literal">$.cssHooks</code> and <code class="literal">$.attrHooks</code>. In general, hooks are objects holding a <code class="literal">get</code> method that retrieves the requested value and a <code class="literal">set</code> method that provides a new value.</p><p>Hook types include:</p><div class="informaltable"><table border="1"><colgroup><col style="text-align: left"/><col style="text-align: left"/><col style="text-align: left"/></colgroup><thead><tr><th style="text-align: left" valign="bottom">
<p>Hook type</p>
</th><th style="text-align: left" valign="bottom">
<p>Method altered</p>
</th><th style="text-align: left" valign="bottom">
<p>Example usage</p>
</th></tr></thead><tbody><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$.attrHooks</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">.attr()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Prevents <a id="id1015" class="indexterm"/>
<a id="id1016" class="indexterm"/>the <a id="id1017" class="indexterm"/>
<code class="literal">type</code> attribute of an element from being changed.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$.cssHooks</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">.css()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Provides <a id="id1018" class="indexterm"/>
<a id="id1019" class="indexterm"/>
<a id="id1020" class="indexterm"/>special handling for <code class="literal">opacity</code> in Internet Explorer.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$.propHooks</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">.prop()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Corrects the <a id="id1021" class="indexterm"/>
<a id="id1022" class="indexterm"/>behavior of <a id="id1023" class="indexterm"/>the <code class="literal">selected</code> property in Safari.</p>
</td></tr><tr><td style="text-align: left" valign="top">
<p>
<code class="literal">$.valHooks</code>
</p>
</td><td style="text-align: left" valign="top">
<p>
<code class="literal">.val()</code>
</p>
</td><td style="text-align: left" valign="top">
<p>Allows <a id="id1024" class="indexterm"/>
<a id="id1025" class="indexterm"/>
<a id="id1026" class="indexterm"/>radio buttons and checkboxes to report a consistent value across browsers.</p>
</td></tr></tbody></table></div><p>Usually the work performed by these hooks is completely hidden to us, and we can receive their benefits without thinking <a id="id1027" class="indexterm"/>much about what is going on. Sometimes, though, we might want to extend the behavior of jQuery's methods by adding hooks of our own.</p><div class="section" title="Writing a CSS hook"><div class="titlepage"><div><div><h3 class="title"><a id="ch12lvl3sec27"/>Writing a CSS hook</h3></div></div></div><p>The code in <span class="emphasis"><em>Listing 12.14</em></span> injects a CSS property called <a id="id1028" class="indexterm"/>
<code class="literal">glowColor</code> onto the page. This has no effect on the page at the moment, as such a property does not exist. Instead, we are going to extend <code class="literal">$.cssHooks</code> to add support for this newly-invented property. We will add a soft glow around the text using the <a id="id1029" class="indexterm"/>CSS3 <code class="literal">text-shadow</code> property when <code class="literal">glowColor</code> is set on an element. Since <code class="literal">text-shadow</code> is not supported in Internet Explorer before version 10, we will implement the glow there using Microsoft's proprietary <code class="literal">filter</code> property:</p><div class="informalexample"><pre class="programlisting">(function($) {
  var div = document.createElement('div');
  $.support.textShadow = div.style.textShadow === '';
  $.support.filter = div.style.filter === '';
  div = null;
  if ($.support.textShadow) {
    $.cssHooks.glowColor = {
      set: function(elem, value) {
        if (value == 'none') {
          elem.style.textShadow = '';
        }
        else {
          elem.style.textShadow = '0 0 2px ' + value;
        }
      }
    };
  }
  else {
    $.cssHooks.glowColor = {
      set: function(elem, value) {
        if (value == 'none') {
          elem.style.filter = '';
        }
        else {
          elem.style.zoom = 1;
          elem.style.filter =
            'progid:DXImageTransform.Microsoft' +
            '.Glow(Strength=2, Color=' + value + ');';
        }
      }
    };
  }
})(jQuery);</pre></div><p>
<span class="emphasis"><em>Listing 12.15</em></span>
</p><p>A hook consists of a <code class="literal">get</code> method <a id="id1030" class="indexterm"/>and a <a id="id1031" class="indexterm"/>
<code class="literal">set</code> method for an element. To keep our example as brief and simple as possible, we are only defining <code class="literal">set</code> at this time. We run some feature compatibility tests before defining any hooks. If <code class="literal">text-shadow</code> is supported by the browser, we define a version of the hook that uses that property. If not, we check for support for DirectX filters and use those <a id="id1032" class="indexterm"/>if possible. If neither are available, the hook is not defined at all, so <code class="literal">glowColor</code> will do nothing.</p><p>With this hook in place, we now have a 2 pixel soft green glow around the heading text:</p><div class="mediaobject"><img src="graphics/3145OS_12_07.jpg" alt="Writing a CSS hook"/></div><p>While the new hook works as advertised, it lacks many features that we might expect. Some of these shortcomings include:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">The size of the glow is not customizable</li><li class="listitem" style="list-style-type: disc">The effect is mutually exclusive with other uses of <code class="literal">text-shadow</code> or <code class="literal">filter</code></li><li class="listitem" style="list-style-type: disc">The <code class="literal">get</code> callbacks are unimplemented, so we cannot test for the current value of the property</li><li class="listitem" style="list-style-type: disc">The property cannot be animated</li></ul></div><p>With enough work and additional code, we could surmount all of these obstacles. In practice, we do not often have to define our own hooks, however; skilled plugin developers have created hooks for a wide <a id="id1033" class="indexterm"/>variety of needs, including most CSS3 properties.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip62"/>Tip</h3><p>
<span class="strong"><strong>Finding hooks</strong></span>
</p><p>The plugin landscape changes <a id="id1034" class="indexterm"/>rapidly, so new hooks will crop up all the time, and we cannot hope to list them all here. For a sampling of what is possible, see Brandon Aaron's collection of <a id="id1035" class="indexterm"/>CSS hooks at <a class="ulink" href="https://github.com/brandonaaron/jquery-cssHooks">https://github.com/brandonaaron/jquery-cssHooks</a>.</p></div></div></div></div></div></body></html>
