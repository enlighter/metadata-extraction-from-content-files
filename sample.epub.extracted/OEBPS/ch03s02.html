<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Handling simple events</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Handling simple events"><div class="titlepage"><div><div><h1 class="title"><a id="ch03lvl1sec24"/>Handling simple events</h1></div></div></div><p>There are many other times <a id="id183" class="indexterm"/>apart from the loading of the page at which we might want to perform a task. Just as JavaScript allows us to intercept the page load event with <code class="literal">&lt;body onload=""&gt;</code> or <code class="literal">window.onload</code>, it provides similar hooks for user-initiated events such as mouse clicks (<code class="literal">onclick</code>), form fields being modified (<code class="literal">onchange</code>), and windows changing size (<code class="literal">onresize</code>). When assigned directly to elements in the DOM, these hooks have similar drawbacks to the ones we outlined for <code class="literal">onload</code>. Therefore, jQuery offers an improved way of handling these events as well.</p><div class="section" title="A simple style switcher"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec24"/>A simple style switcher</h2></div></div></div><p>To illustrate some event <a id="id184" class="indexterm"/>handling techniques, suppose we wish to have a single page rendered in several different styles based on user input. We will present buttons that allow the user to toggle between a normal view, a view in which the text is constrained to a narrow column, and a view with large print for the content area.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip12"/>Tip</h3><p>
<span class="strong"><strong>Progressive enhancement</strong></span>
</p><p>In a real-world example, a good web citizen will employ the principle of progressive enhancement here. In <a class="link" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Manipulating the DOM">Chapter 5</a>, <span class="emphasis"><em>Manipulating the DOM</em></span>, we will learn how we can inject content like this style switcher right from our jQuery code, so that users without JavaScript available will not see non-functional controls.</p></div></div><p>The HTML markup for the style switcher is as follows:</p><div class="informalexample"><pre class="programlisting">&lt;div id="switcher" class="switcher"&gt;
  &lt;h3&gt;Style Switcher&lt;/h3&gt;
  &lt;button id="switcher-default"&gt;
    Default
  &lt;/button&gt;
  &lt;button id="switcher-narrow"&gt;
    Narrow Column
  &lt;/button&gt;
  &lt;button id="switcher-large"&gt;
    Large Print
  &lt;/button&gt;
&lt;/div&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip13"/>Tip</h3><p>
<span class="strong"><strong>Downloadable code examples</strong></span>
</p><p>As with many of the HTML, CSS, and JavaScript examples in this book, the preceding markup is merely a fragment of the complete document. To experiment with the examples, you can download them from the Packt Publishing website at <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a>. In addition, the examples can be viewed in an interactive browser at <a class="ulink" href="http://book.learningjquery.com/">http://book.learningjquery.com/</a>.</p></div></div><p>Combined with the rest of the <a id="id185" class="indexterm"/>page's HTML markup and some basic CSS, we get a page that looks like the following:</p><div class="mediaobject"><img src="graphics/3145OS_03_01.jpg" alt="A simple style switcher"/></div><p>To begin with, we'll make the <span class="strong"><strong>Large Print</strong></span> button operate. We need a bit of CSS to implement our alternative view of the page as follows:</p><div class="informalexample"><pre class="programlisting">body.large .chapter {
  font-size: 1.5em;
}</pre></div><p>Our goal, then, is to apply the <code class="literal">large</code> class to the <code class="literal">&lt;body&gt;</code> tag. This will allow the stylesheet to reformat the page appropriately. Using what we learned in <a class="link" href="ch02.html" title="Chapter&#xA0;2.&#xA0;Selecting Elements">Chapter 2</a>, <span class="emphasis"><em>Selecting Elements</em></span>, we already know the statement needed to accomplish this:</p><div class="informalexample"><pre class="programlisting">$('body').addClass('large');</pre></div><p>However, we want this to occur when the button is clicked, not when the page is loaded as we have seen so far. To do <a id="id186" class="indexterm"/>this, we'll introduce the <code class="literal">.on()</code> method. This method allows <a id="id187" class="indexterm"/>us to specify any DOM event and to attach a behavior to it. In this case, the event is called <code class="literal">click</code>, and the behavior is a function consisting of our previous one-liner:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-large').on('click', function() {
    $('body').addClass('large');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.1</em></span>
</p><p>Now when the button gets clicked on, our code runs and the text is enlarged:</p><div class="mediaobject"><img src="graphics/3145OS_03_02.jpg" alt="A simple style switcher"/></div><p>That's all there is to binding a behavior to an event. The advantages we discussed with the <code class="literal">.ready()</code> method apply here as well. Multiple calls to <code class="literal">.on()</code> coexist nicely, appending additional behaviors to the same event as necessary.</p><p>This is not necessarily the most <a id="id188" class="indexterm"/>elegant or efficient way to accomplish this task. As we proceed through this chapter, we will extend and refine this code into something we can be proud of.</p></div><div class="section" title="Enabling the other buttons"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec25"/>Enabling the other buttons</h2></div></div></div><p>We now have a <span class="strong"><strong>Large Print</strong></span> <a id="id189" class="indexterm"/>button that works as advertised, but we need to apply similar handling to the other two buttons (<span class="strong"><strong>Default</strong></span> and <span class="strong"><strong>Narrow Column</strong></span>) to make them perform their tasks. This is straightforward; we use <code class="literal">.on()</code> to add a <code class="literal">click</code> handler to each of them, removing and adding classes as necessary. The new code reads as follows:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-default').on('click', function() {
    $('body').removeClass('narrow');
    $('body').removeClass('large');
  });
  $('#switcher-narrow').on('click', function() {
    $('body').addClass('narrow');
    $('body').removeClass('large');
  });
  $('#switcher-large').on('click', function() {
    $('body').removeClass('narrow');
    $('body').addClass('large');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.2</em></span>
</p><p>This is combined with a <a id="id190" class="indexterm"/>CSS rule for the <code class="literal">narrow</code> class:</p><div class="informalexample"><pre class="programlisting">body.narrow .chapter {
  width: 250px;
}</pre></div><p>Now, after clicking the <span class="strong"><strong>Narrow Column</strong></span> button, its corresponding CSS is applied and the text gets laid out differently:</p><div class="mediaobject"><img src="graphics/3145OS_03_03.jpg" alt="Enabling the other buttons"/></div><p>Clicking on <span class="strong"><strong>Default</strong></span> removes <a id="id191" class="indexterm"/>both class names from the <code class="literal">&lt;body&gt;</code> tag, returning the page to its initial rendering.</p></div><div class="section" title="Making use of the event handler context"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec26"/>Making use of the event handler context</h2></div></div></div><p>Our switcher is behaving <a id="id192" class="indexterm"/>correctly, but we are not giving the user <a id="id193" class="indexterm"/>any feedback about which button is currently active. Our approach for handling this will be to apply the <code class="literal">selected</code> class to the button when it is clicked, and to remove this class <a id="id194" class="indexterm"/>from the other buttons. The <code class="literal">selected</code> class simply makes the button's text bold:</p><div class="informalexample"><pre class="programlisting">.selected {
  font-weight: bold;
}</pre></div><p>We could accomplish this class modification as we did previously by referring to each button by ID and applying or removing classes as necessary, but instead we'll explore a more elegant and scalable solution that exploits the context in which event handlers run.</p><p>When any event handler is triggered, the keyword <code class="literal">this</code> refers to the DOM element to which the behavior was attached. Earlier we noted that the <code class="literal">$()</code> function could take a DOM element as its argument; this is one of the key reasons why that facility is available. By writing <code class="literal">$(this)</code> within the event handler, we create a jQuery object corresponding to the element, and we can act on it just as if we had located it with a CSS selector.</p><p>With this in mind, we can write the following:</p><div class="informalexample"><pre class="programlisting">$(this).addClass('selected');</pre></div><p>Placing this line in each of the three handlers will add the class when a button is clicked. To remove the class from the other buttons, we can take advantage of jQuery's implicit iteration feature, and write:</p><div class="informalexample"><pre class="programlisting">$('#switcher button').removeClass('selected');</pre></div><p>This line removes the class from every button inside the style switcher.</p><p>We should also add the class to the <span class="strong"><strong>Default</strong></span> button when the document is ready. So, placing these in the correct order,  code is as follows:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
$('#switcher-default')
  .addClass('selected')
  .on('click', function() {
    $('body').removeClass('narrow');
    $('body').removeClass('large');
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
  $('#switcher-narrow').on('click', function() {
    $('body').addClass('narrow');
    $('body').removeClass('large');
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
  $('#switcher-large').on('click', function() {
    $('body').removeClass('narrow');
    $('body').addClass('large');
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.3</em></span>
</p><p>Now the style switcher gives appropriate feedback.</p><p>Generalizing the statements <a id="id195" class="indexterm"/>by using the handler context allows us to be yet more efficient. We can factor the highlighting routine out into a separate handler, as shown in <span class="emphasis"><em>Listing 3.4</em></span>, because it is the same for all three buttons:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-default')
  .addClass('selected')
  .on('click', function() {
    $('body').removeClass('narrow').removeClass('large');
  });
  $('#switcher-narrow').on('click', function() {
    $('body').addClass('narrow').removeClass('large');
  });
  $('#switcher-large').on('click', function() {
    $('body').removeClass('narrow').addClass('large');
  });
  $('#switcher button').on('click', function() {
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.4</em></span>
</p><p>This optimization takes advantage of three jQuery features we have already discussed. First, <span class="strong"><strong>implicit iteration</strong></span> is once again <a id="id196" class="indexterm"/>useful when we bind the same <code class="literal">click</code> handler to each button with a single call to <code class="literal">.on()</code>. Second, <span class="strong"><strong>behavior queuing</strong></span> allows us to bind two functions to <a id="id197" class="indexterm"/>the same click event without the second <a id="id198" class="indexterm"/>overwriting the first. Lastly, we're using jQuery's <span class="strong"><strong>chaining</strong></span> capabilities to collapse the adding and removing of classes into a single line of code each time.</p></div><div class="section" title="Consolidating code using the event context"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec27"/>Consolidating code using the event context</h2></div></div></div><p>The code optimization we've just <a id="id199" class="indexterm"/>completed is an example of <span class="strong"><strong>refactoring</strong></span>&#x2014;modifying existing code to perform the same task in a more efficient or elegant way. To explore further <a id="id200" class="indexterm"/>refactoring opportunities, let's look at the behaviors we have bound to each button. The<a id="id201" class="indexterm"/> <code class="literal">.removeClass()</code> method's parameter is optional; when omitted, it removes all classes from the element. We can streamline our code a bit by exploiting this as follows:</p><div class="informalexample"><pre class="programlisting">// work in progress 
$(document).ready(function() {
  $('#switcher-default')
  .addClass('selected')
  .on('click', function() {
<span class="strong"><strong>    $('body').removeClass();</strong></span>
  });
  $('#switcher-narrow').on('click', function() {
<span class="strong"><strong>    $('body').removeClass().addClass('narrow');</strong></span>
  });
  $('#switcher-large').on('click', function() {
<span class="strong"><strong>    $('body').removeClass().addClass('large');</strong></span>
  });
  $('#switcher button').on('click', function() {
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.5</em></span>
</p><p>Note that the order of operations has changed a bit to accommodate our more general class removal; we need to execute <code class="literal">.removeClass()</code> first so that it doesn't undo the call to <code class="literal">.addClass()</code>, which we perform in the same breath.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip14"/>Tip</h3><p>We can only safely remove all classes because we are in charge of the HTML in this case. When we are writing code for reuse (such as for a plugin), we need to respect any classes that might be present and leave them intact.</p></div></div><p>Now we are executing some of the <a id="id202" class="indexterm"/>same code in each of the buttons' handlers. This can be easily factored out into our general button <code class="literal">click</code> handler:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-default').addClass('selected');
  $('#switcher button').on('click', function() {
<span class="strong"><strong>    $('body').removeClass();</strong></span>
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
  $('#switcher-narrow').on('click', function() {
    $('body').addClass('narrow');
  });
  $('#switcher-large').on('click', function() {
    $('body').addClass('large');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.6</em></span>
</p><p>Note that we need to move the general handler above the specific ones now. The <code class="literal">.removeClass()</code> call needs to happen <a id="id203" class="indexterm"/>before <a id="id204" class="indexterm"/>
<code class="literal">.addClass()</code> executes, and we can count on this because jQuery always triggers event handlers in the order in which they were registered.</p><p>Finally, we can get rid of the specific handlers entirely by once again exploiting <span class="strong"><strong>event context</strong></span>. Since the context keyword <code class="literal">this</code> gives us a DOM element rather than a jQuery object, we can use native DOM properties to determine the ID of the element that was clicked. We can thus bind the same handler to all the buttons, and within the handler perform different actions for each button:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-default').addClass('selected');
  $('#switcher button').on('click', function() {
    var bodyClass = this.id.split('-')[1];
    $('body').removeClass().addClass(bodyClass);
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.7</em></span>
</p><p>The value of the <code class="literal">bodyClass</code> <a id="id205" class="indexterm"/>variable will be <code class="literal">default</code>, <code class="literal">narrow</code>, or <code class="literal">large</code>, depending on which button is clicked. Here, we are departing somewhat from our previous code; in that we are adding a <code class="literal">default</code> class to <code class="literal">&lt;body&gt;</code> when the user clicks on <code class="literal">&lt;button id="switcher-default"&gt;</code>. While we do not need this class applied, it isn't causing any harm either, and the reduction of code complexity more than makes up for an unused class name.</p></div><div class="section" title="Shorthand events"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec28"/>Shorthand events</h2></div></div></div><p>Binding a handler for an event (such as a simple <code class="literal">click</code> event) is such a common task that jQuery provides an even terser way to accomplish it; shorthand event methods work in the same way as their <code class="literal">.on()</code> counterparts with a couple fewer keystrokes.</p><p>For example, our style <a id="id206" class="indexterm"/>switcher could be written using <code class="literal">.click()</code> instead of <code class="literal">.on()</code> as follows:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher-default').addClass('selected');
  $('#switcher button').click(function() {
    var bodyClass = this.id.split('-')[1];
    $('body').removeClass().addClass(bodyClass);
    $('#switcher button').removeClass('selected');
    $(this).addClass('selected');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.8</em></span>
</p><p>Shorthand event methods such as the previous one exist for the other standard DOM events such as <code class="literal">blur</code>, <code class="literal">keydown</code>, and <code class="literal">scroll</code> as well. Each shortcut method binds a handler to the event with the corresponding name.</p></div><div class="section" title="Showing and hiding advanced features"><div class="titlepage"><div><div><h2 class="title"><a id="ch03lvl2sec29"/>Showing and hiding advanced features</h2></div></div></div><p>Suppose that we wanted to be able to hide our style switcher when it is not needed. One convenient way to hide advanced features is to make them collapsible. We will allow one click on the label to hide the buttons, leaving the label alone. Another click on the label will restore the buttons. We need another class as follows to handle the hidden buttons:</p><div class="informalexample"><pre class="programlisting">.hidden {
  display: none;
}</pre></div><p>We could implement this feature by storing the current state of the buttons in a variable and checking its value each time the label is clicked to know whether to add or remove the hidden class on the buttons. However, <a id="id207" class="indexterm"/>jQuery provides an easy way for us to add or remove a class depending on whether that class is already present&#x2014;the <code class="literal">.toggleClass()</code> method.</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#switcher h3').click(function() {
    $('#switcher button').toggleClass('hidden');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 3.9</em></span>
</p><p>After the first click, the buttons are all hidden:</p><div class="mediaobject"><img src="graphics/3145OS_03_04.jpg" alt="Showing and hiding advanced features"/></div><p>And a second click returns them to visibility:</p><div class="mediaobject"><img src="graphics/3145OS_03_05.jpg" alt="Showing and hiding advanced features"/></div><p>Once again, we rely on implicit iteration, this time to hide all the buttons in one fell swoop without requiring an enclosing element.</p></div></div></body></html>
