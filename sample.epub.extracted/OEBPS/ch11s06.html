<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Taking fine-grained control of animations</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Taking fine-grained control of animations"><div class="titlepage"><div><div><h1 class="title"><a id="ch11lvl1sec89"/>Taking fine-grained control of animations</h1></div></div></div><p>Even as we've looked at a number of advanced features, jQuery's effects module offers much more to explore. A rewrite of this module for jQuery 1.8 introduced a number of ways for advanced developers to <a id="id920" class="indexterm"/>fine tune various effects and even change the underlying engine that drives the animations. For example, in addition to offering options such as <code class="literal">duration</code> and <code class="literal">easing</code>, the <code class="literal">.animate()</code> method provides a couple of callback options that let us inspect and modify an animation each step of the way:</p><div class="informalexample"><pre class="programlisting">$('#mydiv').animate({
  height: '200px',
  width: '400px'
}, {
  step: function(now, tween) {
   // monitor height and width
   // adjust tween properties
  },
  progress: function(animation, progress, remainingMs) {
  }
});</pre></div><p>The <code class="literal">step()</code> function, <a id="id921" class="indexterm"/>which is called roughly once every 13 milliseconds for each animated property during the animation, allows us to adjust properties of the <code class="literal">tween</code> object such as the end value, the type of easing, or the actual property being animated based on the current value of a property via the passed <code class="literal">now</code> argument. A complex demonstration might, for example, use the <code class="literal">step()</code> function to detect a collision between two moving elements and adjust their trajectories on impact.</p><p>The <code class="literal">progress()</code> function <a id="id922" class="indexterm"/>is similarly called multiple times throughout the lifecycle of an animation:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">It differs from <code class="literal">step()</code> in that it is called only once per element at each step, regardless of how many properties are being animated</li><li class="listitem" style="list-style-type: disc">It makes available different aspects of the animation, including the animation's promise object, the progress, which is a number between <code class="literal">0</code> and <code class="literal">1</code>, and the number of milliseconds remaining in the animation</li></ul></div><p>All of jQuery's animations use a JavaScript timer function called <code class="literal">setTimeout()</code> to repeatedly call functions&#x2014;every 13 milliseconds by default&#x2014;and change the style properties during each tick. Some modern browsers, however, provide a new <code class="literal">requestAnimationFrame()</code> function that has advantages over <code class="literal">setTimeout()</code>, including increased precision (and therefore perceived smoothness of animations) and improved battery consumption for mobile devices.</p><p>While <code class="literal">setTimeout()</code> typically runs in any browser tab whether it is the active tab or not, <code class="literal">requestAnimationFrame()</code> pauses unless the page is visible and thereby consumes less power. Corey Frang, who led jQuery's <a id="id923" class="indexterm"/>animation rewrite, authored a short plugin that replaces <code class="literal">setTimeout()</code> with <code class="literal">requestAnimationFrame()</code> when it's available. The plugin, which modifies two methods of the <code class="literal">$.fx</code> object, <code class="literal">.timer()</code> and <code class="literal">.stop()</code>, is available for free download at <a class="ulink" href="https://github.com/gnarf37/jquery-requestAnimationFrame/">https://github.com/gnarf37/jquery-requestAnimationFrame/</a>.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note20"/>Note</h3><p>The <code class="literal">requestAnimationFrame()</code> approach to animations is usually preferable to <code class="literal">setTimeout()</code>. However, <a id="id924" class="indexterm"/>because of potential conflicts when the two are used in the same code, <code class="literal">requestAnimationFrame()</code> is not implemented in the jQuery core library.</p></div></div><p>At the lowest level of jQuery's animation system lie its <code class="literal">$.Animation()</code> and <code class="literal">$.Tween()</code> functions. These functions and their corresponding objects can be used to tweak every possible aspect of an animation. For example, we can use <code class="literal">$.Animation</code> to create an animation <span class="strong"><strong>prefilter</strong></span>
<a id="id925" class="indexterm"/>
<span class="strong"><strong>.</strong></span> One such prefilter could take a particular action at the end of an animation based on the existence of a <a id="id926" class="indexterm"/>property passed to the <code class="literal">.animate()</code> method's <code class="literal">options</code> object:</p><div class="informalexample"><pre class="programlisting">$.Animation.prefilter(function(element, properties, options) {
  if (options.removeAfter) {
    this.done(function () {
      $(element).remove();
    });
  }
});</pre></div><p>With this code in place, calling <code class="literal">$('#my-div').fadeOut({removeAfter: true})</code> would automatically remove <code class="literal">&lt;div&gt;</code> from the DOM after it has finished fading out.</p></div></body></html>
