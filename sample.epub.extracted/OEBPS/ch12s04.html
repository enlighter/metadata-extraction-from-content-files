<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Using HTML5 custom data attributes</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Using HTML5 custom data attributes"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec95"/>Using HTML5 custom data attributes</h1></div></div></div><p>So far, we've been relying <a id="id981" class="indexterm"/>on the content within the table cells to determine the sort order. While we've managed to sort the rows correctly by manipulating that content, we can make our code more efficient by outputting more HTML from the server in the form of <a id="id982" class="indexterm"/>
<span class="strong"><strong>HTML5 data-* attributes</strong></span>. The second table in our example page includes these attributes:</p><div class="informalexample"><pre class="programlisting">&lt;table id="t-2" class="sortable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th data-sort='{"key":"title"}'&gt;Title&lt;/th&gt;
      &lt;th data-sort='{"key":"authors"}'&gt;Author(s)&lt;/th&gt;
      &lt;th data-sort='{"key":"publishedYM"}'&gt;Publish Date&lt;/th&gt;
      &lt;th data-sort='{"key":"price"}'&gt;Price&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr data-book='{"img":"2862_OS.jpg",
      "title":"DRUPAL 7","authors":"MERCER DAVID","published":"September 2010","price":44.99,"publishedYM":"2010-09"}'&gt;
      &lt;td&gt;&lt;img src="images/2862_OS.jpg" alt="Drupal 7"&gt;&lt;/td&gt;
      &lt;td&gt;Drupal 7&lt;/td&gt;
      &lt;td&gt;David Mercer&lt;/td&gt;
      &lt;td&gt;September 2010&lt;/td&gt;
      &lt;td&gt;$44.99&lt;/td&gt;
    &lt;/tr&gt;
    &lt;!-- code continues --&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</pre></div><p>Notice that each <code class="literal">&lt;th&gt;</code> element (except the first) has a <code class="literal">data-sort</code> attribute and each <code class="literal">&lt;tr&gt;</code> element has a <code class="literal">data-book</code> attribute. We first saw custom data attributes in <a class="link" href="ch07.html" title="Chapter&#xA0;7.&#xA0;Using Plugins">Chapter 7</a>, <span class="emphasis"><em>Using Plugins</em></span>, where we provided information in attributes for plugin code to use. Here, we will use jQuery to access the attribute values ourselves. To retrieve the value, we pass the part of the attribute's name after <code class="literal">data-</code> to the <code class="literal">.data()</code> method. For example, we write <code class="literal">$('th').first().data('sort')</code> to get the value of the first <code class="literal">&lt;th&gt;</code> element's <code class="literal">data-sort</code> attribute.</p><p>When we use the <code class="literal">.data()</code>
<a id="id983" class="indexterm"/>method to get the value of a data attribute, jQuery converts the value to a number, array, object, Boolean, or null if it determines that it is one of those types. Objects must be denoted using JSON syntax, as we are doing here. Because the JSON format requires double quotes for its keys and string values, we need to use single quotes to surround the attribute value:</p><div class="informalexample"><pre class="programlisting">&lt;th data-sort='{"key":"title"}'&gt;</pre></div><p>Since jQuery converts this JSON string to an object for us, getting at the values we want is simple. To get the value of the <code class="literal">key</code> property, for example, we write:</p><div class="informalexample"><pre class="programlisting">$('th').first().data('sort').key</pre></div><p>Once a custom data attribute is retrieved in this way, the data is stored internally by jQuery and the HTML <a id="id984" class="indexterm"/>
<code class="literal">data-*</code> attribute itself is no longer accessed or modified.</p><p>One great benefit of using data attributes here is that the stored values can be different from the table cell content. In other words, all of the work that we had to do in the first table to finesse the sorting&#x2014;converting strings to upper case, changing the date format, converting the price to a number&#x2014;is already taken care of. This allows us to write much simpler and more efficient sorting code:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $table2 = $('#t-2');
  var $headers = $table2.find('thead th').slice(1);
  $headers
    .wrapInner('&lt;a href="#"&gt;&lt;/a&gt;')
    .addClass('sort');
  var rows = $table2.find('tbody &gt; tr').get();
  $headers.on('click', function(event) {
    event.preventDefault();
    var $header = $(this),
<span class="strong"><strong>        sortKey = $header.data('sort').key,</strong></span>
        sortDirection = 1;
    if ($header.hasClass('sorted-asc')) {
      sortDirection = -1;
    }
    rows.sort(function(a, b) {
<span class="strong"><strong>      var keyA = $(a).data('book')[sortKey];</strong></span>
<span class="strong"><strong>      var keyB = $(b).data('book')[sortKey];</strong></span>
      if (keyA &lt; keyB) return -sortDirection;
      if (keyA &gt; keyB) return sortDirection;
      return 0;
    });
    $headers.removeClass('sorted-asc sorted-desc');
    $header.addClass(sortDirection == 1 ? 'sorted-asc' : 'sorted-desc');
    $.each(rows, function(index, row) {
      $table2.children('tbody').append(row);
    });
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 12.8</em></span>
</p><p>The simplicity of this approach is clear: the <code class="literal">sortKey</code> variable is set with <code class="literal">$header.data('sort').key</code> and is <a id="id985" class="indexterm"/>then used to compare the rows' sort values with <code class="literal">$(a).data('book')[sortKey]</code> and <code class="literal">$(a).data('book')[sortKey]</code>. The efficiency is evident in that there is no need to loop through the rows first and call one of the <code class="literal">sortKeys</code> functions each time before calling the <code class="literal">sort</code> function. With this combination of simplicity and efficiency, we've also improved the code's performance and made it easier to maintain.</p></div></body></html>
