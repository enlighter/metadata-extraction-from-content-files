<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Creating custom animations</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Creating custom animations"><div class="titlepage"><div><div><h1 class="title"><a id="ch04lvl1sec34"/>Creating custom animations</h1></div></div></div><p>In addition to the prebuilt <a id="id330" class="indexterm"/>effect methods, jQuery provides a powerful <code class="literal">.animate()</code> method that allows us to create our own custom animations with fine-grained control. The <code class="literal">.animate()</code> method <a id="id331" class="indexterm"/>comes in two forms. The first takes up to four arguments:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">An object of style properties and values, which is similar to the <code class="literal">.css()</code> argument discussed earlier in this chapter</li><li class="listitem" style="list-style-type: disc">An optional duration, which can be one of the preset strings or a number of milliseconds</li><li class="listitem" style="list-style-type: disc">An optional easing type, which is an option that we will not use now, but which we will discuss in it in <a class="link" href="ch11.html" title="Chapter&#xA0;11.&#xA0;Advanced Effects">Chapter 11</a>, <span class="emphasis"><em>Advanced Effects</em></span></li><li class="listitem" style="list-style-type: disc">An optional callback function, which will be discussed later in this chapter</li></ul></div><p>All together, the four arguments look like this:</p><div class="informalexample"><pre class="programlisting">.animate({property1: 'value1', property2: 'value2'}, 
duration, easing, function() {
    alert('The animation is finished.');
  }
);</pre></div><p>The second form takes two arguments: an object of properties and an object of options:</p><div class="informalexample"><pre class="programlisting">.animate({properties}, {options})</pre></div><p>In effect, the second argument wraps up the second through fourth arguments of the first form into another object and adds some more advanced options to the mix. When we adjust the line breaks for readability, the second form looks like this:</p><div class="informalexample"><pre class="programlisting">.animate({
  property1: 'value1', 
  property2: 'value2'
}, {
  duration: 'value', 
  easing: 'value',
  specialEasing: {
    property1: 'easing1',
    property2: 'easing2'
  },
  complete: function() {
    alert('The animation is finished.');
  },
  queue: true,
  step: callback
});</pre></div><p>For now, we'll use the first <a id="id332" class="indexterm"/>form of the <code class="literal">.animate()</code> method, but we'll return to the second form later in the chapter when we discuss queuing effects.</p><div class="section" title="Building effects by hand"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec47"/>Building effects by hand</h2></div></div></div><p>We have already seen several <a id="id333" class="indexterm"/>prepackaged effects for showing and hiding elements. To begin our discussion of the <code class="literal">.animate()</code> method, it will be useful to see <a id="id334" class="indexterm"/>how we could achieve the same results by calling <code class="literal">.slideToggle()</code> using this lower-level interface. Replacing the <code class="literal">.slideToggle()</code> line of the previous example with our custom animation turns out to be quite simple:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $firstPara = $('p').eq(1);
  $firstPara.hide();
  $('a.more').click(function(event) {
    event.preventDefault();
    $firstPara.animate({height: 'toggle'}, 'slow');
    var $link = $(this);
    if ($link.text() == 'read more') {
      $link.text('read less'); 
    } else {
      $link.text('read more');
    }
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 4.13</em></span>
</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip25"/>Tip</h3><p>This is not a perfect replacement for .<code class="literal">slideToggle()</code>; the actual implementation also animates the margin and padding of elements.</p></div></div><p>As the example illustrates, the <code class="literal">.animate()</code> method provides convenient shorthand values for CSS properties, such as <code class="literal">'show'</code>, <code class="literal">'hide'</code>, and <code class="literal">'toggle'</code>, to ease the process when we want to emulate the behavior of prepackaged effect methods such as <code class="literal">.slideToggle()</code>.</p></div><div class="section" title="Animating multiple properties at once"><div class="titlepage"><div><div><h2 class="title"><a id="ch04lvl2sec48"/>Animating multiple properties at once</h2></div></div></div><p>With <a id="id335" class="indexterm"/>the <code class="literal">.animate()</code> method, we can modify any combination of properties simultaneously. For example, to create a simultaneous sliding and fading effect when toggling the second paragraph, we simply add the opacity property-value pair to the properties object of <code class="literal">.animate()</code>:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $firstPara = $('p').eq(1);
  $firstPara.hide();
  $('a.more').click(function(event) {
    event.preventDefault();
    $firstPara.animate({
      opacity: 'toggle',
      height: 'toggle'
    }, 'slow');
    var $link = $(this);
    if ($link.text() == 'read more') {
      $link.text('read less');
    } else {
      $link.text('read more');
    }
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 4.14</em></span>
</p><p>Additionally, we have not only the style properties used for the shorthand effect methods at our disposal, but also numeric CSS properties such as <code class="literal">left</code>, <code class="literal">top</code>, <code class="literal">fontSize</code>, <code class="literal">margin</code>, <code class="literal">padding</code>, and <code class="literal">borderWidth</code>. In <span class="emphasis"><em>Listing 4.5</em></span>, we changed the text size of the speech paragraphs. We could animate this increase or decrease in size by simply substituting the <code class="literal">.animate()</code> method for the <code class="literal">.css()</code> method:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $speech = $('div.speech');
  var defaultSize = $speech.css('fontSize');
  $('#switcher button').click(function() {
    var num = parseFloat($speech.css('fontSize'));
    switch (this.id) {
      case 'switcher-large':
        num *= 1.4;      
        break;
      case 'switcher-small':
        num /= 1.4;
        break;
      default:
        num = parseFloat(defaultSize); 
    }
    $speech.animate({fontSize: num + 'px'}, 'slow');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 4.15</em></span>
</p><p>The extra properties allow us to create much more complex effects, too. We can, for example, move an item from the left-hand side of the page to the right-hand side while increasing its height by 20 pixels and changing its border width to 5 pixels. We will illustrate this complicated set of property animations with the <code class="literal">&lt;div id="switcher"&gt;</code> box. Here is what it looks <a id="id336" class="indexterm"/>like before we animate it:</p><div class="mediaobject"><img src="graphics/3145OS_04_08.jpg" alt="Animating multiple properties at once"/></div><p>With a flexible-width layout, we need to compute the distance that the box needs to travel before it lines up at the right-hand side of the page. Assuming that the paragraph's width is 100 percent, we can subtract the <span class="strong"><strong>Text Size</strong></span> box's width from the paragraph's width. We have the <code class="literal">jQuery's.outerWidth()</code> method at our disposal to calculate these widths, including padding and border. We'll use this method to compute the new <code class="literal">left</code> property of the switcher. For the sake of this example, we'll trigger the animation by clicking on the <span class="strong"><strong>Text Size</strong></span> label just above the buttons. Here is what the code should look like:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('div.label').click(function() {
    var paraWidth = $('div.speech p').outerWidth();
    var $switcher = $(this).parent();
    var switcherWidth = $switcher.outerWidth();
    $switcher.animate({
      borderWidth: '5px',
      left: paraWidth - switcherWidth,
      height: '+=20px'
    }, 'slow');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 4.16</em></span>
</p><p>It is worth examining these animated properties in detail. The <code class="literal">borderWidth</code> property is straightforward, as we are specifying a constant value with units, just as we would in a stylesheet. The <code class="literal">left</code> property is a computed numeric value. The unit suffix is optional on these properties; since we omit it here, <code class="literal">px</code> is assumed. Finally, the height property uses a syntax we have not seen before. The <code class="literal">+=</code> prefix on a property value indicates a relative value. So, instead of animating the height to 20 pixels, the height is animated to 20 pixels greater than the current height. Because of the special characters involved, relative values must be specified as a string, so must be enclosed in quotes.</p><p>Although this code successfully <a id="id337" class="indexterm"/>increases the height of the <code class="literal">&lt;div&gt;</code> tag and widens its border, at the moment, the <code class="literal">left</code> position appears unchanged:</p><div class="mediaobject"><img src="graphics/3145OS_04_09.jpg" alt="Animating multiple properties at once"/></div><p>We still need to enable changing this box's position in the CSS.</p><div class="section" title="Positioning with CSS"><div class="titlepage"><div><div><h3 class="title"><a id="ch04lvl3sec05"/>Positioning with CSS</h3></div></div></div><p>When working with <code class="literal">.animate()</code>, it's important to keep in mind the limitations that CSS imposes on the elements that <a id="id338" class="indexterm"/>we wish to change. For example, adjusting the <code class="literal">left</code> property will have no effect on the matching elements unless those elements have their CSS position set to <code class="literal">relative</code> or <code class="literal">absolute</code>. The default CSS position for all block-level elements is <code class="literal">static</code>, which accurately describes how those elements will remain if we try to move them without first changing their <code class="literal">position</code> value.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="note10"/>Note</h3><p>For more information on absolute and relative positioning, see Joe Gillespie's article <span class="emphasis"><em>Absolutely Relative</em></span> at <a class="ulink" href="http://www.wpdfd.com/issues/78/absolutely_relative/">http://www.wpdfd.com/issues/78/absolutely_relative/</a>.</p></div></div><p>In our stylesheet, we could set <code class="literal">&lt;div id="switcher"&gt;</code> to be relatively positioned:</p><div class="informalexample"><pre class="programlisting">#switcher {
  position: relative;
}</pre></div><p>Instead, though, let's practice our<a id="id339" class="indexterm"/> jQuery skills by altering this property through JavaScript when needed:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('div.label').click(function() {
    var paraWidth = $('div.speech p').outerWidth();
    var $switcher = $(this).parent();
    var switcherWidth = $switcher.outerWidth();
    $switcher.css({
      position: 'relative'
    }).animate({
      borderWidth: '5px',
      left: paraWidth - switcherWidth,
      height: '+=20px'
    }, 'slow');
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 4.17</em></span>
</p><p>With the CSS taken into account, the result of clicking on <span class="strong"><strong>Text Size</strong></span> after the animation has completed will look like this:</p><div class="mediaobject"><img src="graphics/3145OS_04_10.jpg" alt="Positioning with CSS"/></div></div></div></div></body></html>
