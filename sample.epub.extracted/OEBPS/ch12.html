<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter&#xA0;12.&#xA0;Advanced DOM Manipulation</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="chapter" title="Chapter&#xA0;12.&#xA0;Advanced DOM Manipulation"><div class="titlepage"><div><div><h1 class="title"><a id="ch12"/>Chapter&#xA0;12.&#xA0;Advanced DOM Manipulation</h1></div></div></div><p>Throughout this book, we have used jQuery's powerful DOM manipulation methods to alter the content of the document. We have now seen several ways in which we can insert new content, move existing content around, or remove content altogether. We also know how to alter the attributes and properties of elements to suit our needs.</p><p>In <a class="link" href="ch05.html" title="Chapter&#xA0;5.&#xA0;Manipulating the DOM">Chapter 5</a>, <span class="emphasis"><em>Manipulating the DOM</em></span>, we were introduced to these important techniques. In this more advanced chapter, we will cover:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Sorting page elements using <code class="literal">.append()</code></li><li class="listitem" style="list-style-type: disc">Attaching custom data to elements</li><li class="listitem" style="list-style-type: disc">Reading HTML5 data attributes</li><li class="listitem" style="list-style-type: disc">Creating elements from JSON data</li><li class="listitem" style="list-style-type: disc">Extending the DOM manipulation system using CSS hooks</li></ul></div><div class="section" title="Sorting table rows"><div class="titlepage"><div><div><h1 class="title"><a id="ch12lvl1sec92"/>Sorting table rows</h1></div></div></div><p>The majority of the topics we're investigating in this chapter can be demonstrated through sorting the rows of a table. This common task is a very useful way to assist users in quickly finding the information they need. There are, naturally, a number of ways in which the task can be accomplished.</p><div class="section" title="Sorting tables on the server"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec131"/>Sorting tables on the server</h2></div></div></div><p>A common solution for <a id="id927" class="indexterm"/>data sorting is to perform it on the server. Data in tables often comes from a database, which means that the code that pulls it out of the database can request it in a given sort order (using, for example, the SQL language's <code class="literal">ORDER BY</code> clause). If <a id="id928" class="indexterm"/>we have server-side code at our disposal, it is straightforward to begin with a reasonable default sort order.</p><p>Sorting is most useful, though, when the user can determine the sort order. A common user interface for this is to make the table headers (<code class="literal">&lt;th&gt;</code>) of sortable columns into links. These links can go to the current page, but with a query string appended indicating the column to sort by, as shown in the <a id="id929" class="indexterm"/>
<a id="id930" class="indexterm"/>following code snippet:</p><div class="informalexample"><pre class="programlisting">&lt;table id="my-data"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th class="name"&gt;
        &lt;a href="index.php?sort=name"&gt;Name&lt;/a&gt;
      &lt;/th&gt;
      &lt;th class="date"&gt;
        &lt;a href="index.php?sort=date"&gt;Date&lt;/a&gt;
      &lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    ...
  &lt;/tbody&gt;
&lt;/table&gt;</pre></div><p>The server can react to the query string parameter by returning the database contents in a different order.</p></div><div class="section" title="Sorting tables using Ajax"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec132"/>Sorting tables using Ajax</h2></div></div></div><p>This setup is simple, but <a id="id931" class="indexterm"/>
<a id="id932" class="indexterm"/>
<a id="id933" class="indexterm"/>requires a page refresh for each sort operation. As we have seen, jQuery allows us to eliminate such page refreshes by using Ajax methods. If we have the column headers set up as links as before, we can add jQuery code to change those links into Ajax requests:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#my-data th a').click(function(event) {
    event.preventDefault();
    $('#my-data tbody').load($(this).attr('href'));
  });
});</pre></div><p>Now when the anchors are clicked, jQuery sends an Ajax request to the server for the same page. When jQuery is used to make a page request using Ajax, it sets the <code class="literal">X-Requested-With</code> HTTP header to <code class="literal">XMLHttpRequest</code> so that the server can determine that an Ajax request is being made. The server code can be written to send back only the content of the <code class="literal">&lt;tbody&gt;</code> element itself and not the surrounding page when this parameter is present. This way we can use the response to replace the content of the existing <code class="literal">&lt;tbody&gt;</code> element.</p><p>This is an example of <span class="strong"><strong>progressive enhancement</strong></span>. The page works perfectly well without any JavaScript at all, as the links for server-side sorting are still present. When JavaScript is available, however, we hijack <a id="id934" class="indexterm"/>
<a id="id935" class="indexterm"/>
<a id="id936" class="indexterm"/>the page request and allow the sort to occur without a full page load.</p></div><div class="section" title="Sorting tables within the browser"><div class="titlepage"><div><div><h2 class="title"><a id="ch12lvl2sec133"/>Sorting tables within the browser</h2></div></div></div><p>There are times, though, <a id="id937" class="indexterm"/>
<a id="id938" class="indexterm"/>
<a id="id939" class="indexterm"/>when we either don't want to wait for server responses when sorting, or don't have a server-side scripting language available to us. A viable alternative in this case can be to perform the sorting entirely on the browser using JavaScript client-side scripting and jQuery's DOM manipulation methods.</p><p>In order to demonstrate the various techniques in this chapter, we will set up three separate jQuery sorting mechanisms. Each will accomplish the same goal, but in a unique way. Our examples will sort the table using:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">Data extracted from the content of the HTML</li><li class="listitem" style="list-style-type: disc">HTML5 custom data attributes</li><li class="listitem" style="list-style-type: disc">A JSON representation of the table data</li></ul></div><p>The tables that we'll be sorting will have different HTML structures to accommodate the varying JavaScript techniques, but each contains columns listing books, their author names, release dates, and prices. The first table has this simple structure:</p><div class="informalexample"><pre class="programlisting">&lt;table id="t-1" class="sortable"&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;&lt;/th&gt;
      &lt;th class="sort-alpha"&gt;Title&lt;/th&gt;
      &lt;th class="sort-alpha"&gt;Author(s)&lt;/th&gt;
      &lt;th class="sort-date"&gt;Publish Date&lt;/th&gt;
      &lt;th class="sort-numeric"&gt;Price&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;img src="images/2862_OS.jpg" alt="Drupal 7"&gt;&lt;/td&gt;
      &lt;td&gt;Drupal 7&lt;/td&gt;
      &lt;td&gt;David &lt;span class="sort-key"&gt;Mercer&lt;/span&gt;&lt;/td&gt;
      &lt;td&gt;September 2010&lt;/td&gt;
      &lt;td&gt;$44.99&lt;/td&gt;
    &lt;/tr&gt;
    &lt;!-- code continues --&gt;
  &lt;/tbody&gt;
&lt;/table&gt;</pre></div><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip60"/>Tip</h3><p>
<span class="strong"><strong>Downloadable code examples</strong></span>
</p><p>As with many of the HTML, CSS, and JavaScript examples in this book, the previous markup is merely a fragment of the complete document. To experiment with the examples, you can download them from the Packt Publishing website at <a class="ulink" href="http://www.packtpub.com/support">http://www.packtpub.com/support</a>. In addition, the examples can be viewed in an interactive browser at <a class="ulink" href="http://book.learningjquery.com/">http://book.learningjquery.com/</a>.</p></div></div><p>Before we enhance the table <a id="id940" class="indexterm"/>
<a id="id941" class="indexterm"/>
<a id="id942" class="indexterm"/>with JavaScript, the first few rows look like this:</p><div class="mediaobject"><img src="graphics/3145OS_12_01.jpg" alt="Sorting tables within the browser"/></div></div></div></div></body></html>
