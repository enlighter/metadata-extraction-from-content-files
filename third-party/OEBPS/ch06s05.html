<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Keeping an eye on the request</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="Keeping an eye on the request"><div class="titlepage"><div><div><h1 class="title"><a id="ch06lvl1sec49"/>Keeping an eye on the request</h1></div></div></div><p>So far, it has been sufficient for us to make a call to an Ajax method and patiently await the response. At times, though, it is handy to know a bit more about the HTTP request as it progresses. If such a need arises, jQuery offers a suite of functions that can be used to register callbacks when various Ajax-related events occur.</p><p>The <code class="literal">.ajaxStart()</code> <a id="id508" class="indexterm"/>and <code class="literal">.ajaxStop()</code> <a id="id509" class="indexterm"/>methods are two examples of these observer functions. When an Ajax call begins with no other transfer in progress, the <code class="literal">.ajaxStart()</code> callback is fired. Conversely, when the last active request ends, the callback attached with <code class="literal">.ajaxStop()</code> will be executed. All of the observers are global, in that they are called when any Ajax communication occurs, regardless of what code initiates it. And all of them, like the <code class="literal">.ready()</code> method, can only be bound to <code class="literal">$(document)</code>.</p><p>We can use these methods to provide some feedback to the user in the case of a slow network connection. The HTML for the page can have a suitable loading message appended:</p><div class="informalexample"><pre class="programlisting">&lt;div id="loading"&gt;
  Loading...
&lt;/div&gt;</pre></div><p>This message is just a piece of arbitrary HTML; it could include an animated GIF image as a loading indicator, for instance. In this case, we'll add a few simple styles to the CSS file so that when the message is displayed, the page will look like the following:</p><div class="mediaobject"><img src="graphics/3145OS_06_11.jpg" alt="Keeping an eye on the request"/></div><p>In keeping with the spirit of progressive enhancement, however, we won't put this HTML markup directly on the page. It's only relevant for us when JavaScript is available, so we will insert it using jQuery:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('&lt;div id="loading"&gt;Loading...&lt;/div&gt;')
    .insertBefore('#dictionary')
});</pre></div><p>Our CSS file will give this <code class="literal">&lt;div&gt;</code> a <code class="literal">display: none;</code> style declaration so that the message is initially hidden. To display it at the right time, we just register it as an observer with <code class="literal">.ajaxStart()</code>:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $loading = $('&lt;div id="loading"&gt;Loading...&lt;/div&gt;')
    .insertBefore('#dictionary');

  $(document).ajaxStart(function() {
  $loading.show();
  });
});</pre></div><p>We can chain the hiding behavior right onto this.</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  var $loading = $('&lt;div id="loading"&gt;Loading...&lt;/div&gt;')
    .insertBefore('#dictionary');

  $(document).ajaxStart(function() {
    $loading.show();
  }).ajaxStop(function() {
    $loading.hide();
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 6.15</em></span>
</p><p>We now have our loading feedback.</p><p>Once again, note that these methods have no association with the particular ways in which the Ajax communications begin. The <code class="literal">.load()</code> attached to the <span class="strong"><strong>A</strong></span> link and the <code class="literal">.getJSON()</code> method <a id="id510" class="indexterm"/>attached to the <span class="strong"><strong>B</strong></span> link both cause these actions to occur.</p><p>In this case, this global behavior is desirable. If we need to get more specific, though, we have a few options at our disposal. Some of the observer methods, such as <code class="literal">.ajaxError()</code>, send their callback a reference to the <code class="literal">XMLHttpRequest</code> object. This can be used to differentiate one request from another and provide different behaviors. Other more specific handling can be achieved by using the low-level <code class="literal">$.ajax()</code> function, which we'll discuss a bit later.</p><p>The most common way of interacting with the request is the <code class="literal">success</code> callback, which we have already covered. We have used this in several of our examples to interpret the data coming back from the server and to populate the page with the results. It can be used for other feedback too, of course. Consider once again our <code class="literal">.load()</code> example from <span class="emphasis"><em>Listing 6.1</em></span>:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#letter-a a').click(function(event) {
    event.preventDefault();
    $('#dictionary').load('a.html');
  });
});</pre></div><p>We can create a small enhancement here by making the loaded content fade into view rather than appear suddenly. The <code class="literal">.load()</code> method <a id="id511" class="indexterm"/>can take a callback to be fired on completion:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('#letter-a a').click(function(event) {
    event.preventDefault();
    $('#dictionary').hide().load('a.html', function() {
<span class="strong"><strong>      $(this).fadeIn();</strong></span>
    });
  });
});</pre></div><p>
<span class="emphasis"><em>Listing 6.16</em></span>
</p><p>First, we hide the target element and then initiate the load. When the load is complete, we use the callback to show the newly populated element by fading it in.</p></div></body></html>
