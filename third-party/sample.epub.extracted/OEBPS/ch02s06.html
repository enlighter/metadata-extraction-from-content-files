<?xml version="1.0" encoding="utf-8" ?>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"><head><title>DOM traversal methods</title><link rel="stylesheet" href="epub.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.75.2"/></head><body id="page"><div class="section" title="DOM traversal methods"><div class="titlepage"><div><div><h1 class="title"><a id="ch02lvl1sec19"/>DOM traversal methods</h1></div></div></div><p>The jQuery selectors that we have explored so far allow us to select a set of elements as we navigate across and down the <a id="id134" class="indexterm"/>DOM tree and filter the results. If this were the only way to select elements, our options would be somewhat limited. There are many occasions when selecting a parent or ancestor element is essential; that is where jQuery's DOM traversal methods come into play. With these methods at our disposal, we can go up, down, and all around the DOM tree with ease.</p><p>Some of the methods have a nearly identical counterpart among the selector expressions. For example, the line we first used to add the <code class="literal">alt</code> class, <code class="literal">$('tr:even').addClass('alt')</code>, could be rewritten with the <code class="literal">.filter()</code> method as follows:</p><div class="informalexample"><pre class="programlisting">$('tr').filter(':even').addClass('alt');</pre></div><p>For the most part, however, the <a id="id135" class="indexterm"/>two ways of selecting elements complement each other. Also, the <code class="literal">.filter()</code> method in particular has enormous power because it can take a function as its argument. The function allows us to create complex tests for whether elements should be kept in the matched set. Let's suppose, for example, we want to add a class to all external links:</p><div class="informalexample"><pre class="programlisting">a.external {
  background: #fff url(images/external.png) no-repeat 100% 2px;
  padding-right: 16px;
}</pre></div><p>jQuery has no selector for this sort of case. Without a filter function, we'd be forced to explicitly loop through each element, testing each one separately. With the following filter function, however, we can still rely on jQuery's implicit iteration and keep our code compact:</p><div class="informalexample"><pre class="programlisting">$('a').filter(function() {
  return this.hostname &amp;&amp; this.hostname != location.hostname;
}).addClass('external');</pre></div><p>
<span class="emphasis"><em>Listing 2.9</em></span>
</p><p>The second line filters the set of <code class="literal">&lt;a&gt;</code> elements by two criteria:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem" style="list-style-type: disc">They must have an <code class="literal">href</code> attribute with a domain name (<code class="literal">this.hostname</code>). We use this test to exclude mailto links, for instance.</li><li class="listitem" style="list-style-type: disc">The domain name that they link to (again, <code class="literal">this.hostname</code>) must not match (<code class="literal">!=</code>) the domain name of the current page (<code class="literal">location.hostname</code>).</li></ul></div><p>More precisely, the <code class="literal">.filter()</code> method iterates through the matched set of elements, calling the function once for each <a id="id136" class="indexterm"/>and testing the return value. If the function returns <code class="literal">false</code>, the element is removed from the matched set. If it returns <code class="literal">true</code>, the element is kept.</p><p>With the <code class="literal">.filter()</code> method in place, <a id="id137" class="indexterm"/>the <span class="strong"><strong>Henry V</strong></span> link is styled to indicate it is external:</p><div class="mediaobject"><img src="graphics/3145OS_02_12.jpg" alt="DOM traversal methods"/></div><p>In the next section, we'll take another look at our striped table example to see what else is possible with traversal methods.</p><div class="section" title="Styling specific cells"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec17"/>Styling specific cells</h2></div></div></div><p>Earlier, we added a <code class="literal">highlight</code> <a id="id138" class="indexterm"/>class to all cells containing the text <span class="strong"><strong>Henry</strong></span>. To instead <a id="id139" class="indexterm"/>style the cell next to each cell containing <span class="strong"><strong>Henry</strong></span>, we can begin with the selector that we have already written and simply call the <code class="literal">.next()</code> method on the result:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('td:contains(Henry)').next().addClass('highlight');
});</pre></div><p>
<span class="emphasis"><em>Listing 2.10</em></span>
</p><p>The tables should now look like this:</p><div class="mediaobject"><img src="graphics/3145OS_02_13.jpg" alt="Styling specific cells"/></div><p>The <code class="literal">.next()</code> method <a id="id140" class="indexterm"/>selects <a id="id141" class="indexterm"/>only the very next sibling element. To highlight all of the cells following the one containing <a id="id142" class="indexterm"/>
<span class="strong"><strong>Henry</strong></span>, we could use the <code class="literal">.nextAll()</code> method instead:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('td:contains(Henry)').nextAll().addClass('highlight');
});</pre></div><p>
<span class="emphasis"><em>Listing 2.11</em></span>
</p><p>Since the cells containing <span class="strong"><strong>Henry</strong></span> are in the first column of the table, this code causes the rest of the cells in these rows to be highlighted:</p><div class="mediaobject"><img src="graphics/3145OS_02_14.jpg" alt="Styling specific cells"/></div><p>As we might expect, the <code class="literal">.next()</code> and <code class="literal">.nextAll()</code> methods <a id="id143" class="indexterm"/>have counterparts: <code class="literal">.prev()</code> <a id="id144" class="indexterm"/>and <code class="literal">.prevAll()</code>. <a id="id145" class="indexterm"/>Additionally, <code class="literal">.siblings()</code> <a id="id146" class="indexterm"/>selects all other elements at the same DOM level, regardless of whether they come before or after the previously selected element.</p><p>To include the original cell (the one <a id="id147" class="indexterm"/>that contains <span class="strong"><strong>Henry</strong></span>) <a id="id148" class="indexterm"/>along with the cells that follow, we can add the <code class="literal">.addBack()</code> method:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('td:contains(Henry)').nextAll().addBack()
  .addClass('highlight');
});</pre></div><p>
<span class="emphasis"><em>Listing 2.12</em></span>
</p><p>With this modification in place, all of the cells in the row get the styling offered by the <code class="literal">highlight</code> class:</p><div class="mediaobject"><img src="graphics/3145OS_02_15.jpg" alt="Styling specific cells"/></div><p>There are a multitude of selector and traversal-method combinations by which we can select the same set of elements. <a id="id149" class="indexterm"/>Here, for example, is another way to select every cell in each row where at least one of the cells contains <span class="strong"><strong>Henry</strong></span>:</p><div class="informalexample"><pre class="programlisting">$(document).ready(function() {
  $('td:contains(Henry)').parent().children()
  .addClass('highlight');
});</pre></div><p>
<span class="emphasis"><em>Listing 2.13</em></span>
</p><p>Rather than traversing across to sibling <a id="id150" class="indexterm"/>elements, we travel up one level in the DOM to the <code class="literal">&lt;tr&gt;</code> tag with <code class="literal">.parent()</code> and then select all of the row's cells with <code class="literal">.children()</code>.</p></div><div class="section" title="Chaining"><div class="titlepage"><div><div><h2 class="title"><a id="ch02lvl2sec18"/>Chaining</h2></div></div></div><p>The traversal method combinations that <a id="id151" class="indexterm"/>we have just explored illustrate jQuery's chaining capability. <a id="id152" class="indexterm"/>With jQuery, it is possible to select multiple sets of elements and do multiple things with them, all within a single line of code. This chaining not only helps keep jQuery code concise, but it also can improve a script's performance when the alternative is to respecify a selector.</p><div class="note" title="Note" style=""><div class="inner"><h3 class="title"><a id="tip08"/>Tip</h3><p>
<span class="strong"><strong>How chaining works</strong></span>
</p><p>Almost all jQuery methods return a jQuery object and so can have more jQuery methods applied to the result. We will explore the inner workings of chaining in <a class="link" href="ch08.html" title="Chapter&#xA0;8.&#xA0;Developing Plugins">Chapter 8</a>, <span class="emphasis"><em>Developing Plugins</em></span>.</p></div></div><p>It is also possible to break a single line of code into multiple lines for greater readability. For example, a single chained sequence of methods could be written in one line:</p><div class="informalexample"><pre class="programlisting">$('td:contains(Henry)').parent().find('td:eq(1)')
    .addClass('highlight').end().find('td:eq(2)')
                           .addClass('highlight');</pre></div><p>
<span class="emphasis"><em>Listing 2.14</em></span>
</p><p>This same sequence of methods could also be written in seven lines:</p><div class="informalexample"><pre class="programlisting">$('td:contains(Henry)') // Find every cell containing "Henry"
  .parent() // Select its parent
  .find('td:eq(1)') // Find the 2nd descendant cell
  .addClass('highlight') // Add the "highlight" class
  .end() // Return to the parent of the cell containing "Henry"
  .find('td:eq(2)') // Find the 3rd descendant cell
  .addClass('highlight'); // Add the "highlight" class</pre></div><p>
<span class="emphasis"><em>Listing 2.15</em></span>
</p><p>The DOM traversal in this example is contrived and not recommended. There are clearly simpler, more direct methods at our disposal. The point of the example is simply to demonstrate the tremendous flexibility that chaining affords us.</p><p>Chaining can be like speaking a whole paragraph's worth of words in a single breath&#x2014;it gets the job done quickly, but it can be hard for someone else to understand. Breaking it up into multiple lines and adding judicious comments can save more time in the long run.</p></div></div></body></html>
